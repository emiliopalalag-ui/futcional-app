<ion-header>
  <ion-toolbar color="primary">
    <ion-title>Gesti√≥n de Pagos</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">

  <!-- TARJETA DE OPCIONES -->
  <ion-card class="card-opciones">
    <ion-card-header>
      <ion-card-title>Opciones</ion-card-title>
    </ion-card-header>

    <ion-card-content>

      <!-- üîµ RENOVAR (agregar pago) -->
      <ion-button expand="block" shape="round" color="success"
                  (click)="abrirModalAgregar()">
        <ion-icon slot="start" name="refresh-circle-outline"></ion-icon>
        Renovar Inscripci√≥n (Pago)
      </ion-button>

      <!-- üüß LISTAR -->
      <ion-button expand="block" shape="round" color="medium"
                  (click)="abrirModalLista()">
        <ion-icon slot="start" name="list-outline"></ion-icon>
        Listar Pagos
      </ion-button>

    </ion-card-content>
  </ion-card>



  <!-- ========================================================= -->
  <!-- üü© MODAL RENOVAR (AGREGAR PAGO) -->
  <!-- ========================================================= -->
  <ion-modal [isOpen]="modalAgregar" (willDismiss)="modalAgregar = false">
    <ng-template>

      <ion-header>
        <ion-toolbar color="success">
          <ion-title>Renovar Inscripci√≥n</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="modalAgregar = false">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">

        <h2 class="titulo-modal">Renovar inscripci√≥n</h2>

        <ion-list>

          <!-- Selecci√≥n de inscripci√≥n -->
          <ion-item>
            <ion-label>Inscripci√≥n</ion-label>
            <ion-select [(ngModel)]="pagoNuevo.id_inscripcion"
                        interface="popover"
                        (ionChange)="seleccionarInscripcionNuevo()">
              <ion-select-option *ngFor="let i of inscripcionesBonitas"
                                 [value]="i.id">
                {{ i.texto }}
              </ion-select-option>
            </ion-select>
          </ion-item>

          <ion-item *ngIf="pagoNuevo.atleta">
            <ion-label>
              <strong>Atleta:</strong> {{ pagoNuevo.atleta }}<br>
              <strong>Entrenamiento:</strong> {{ pagoNuevo.entrenamiento }}
            </ion-label>
          </ion-item>

          <!-- Monto -->
          <ion-item>
            <ion-label position="floating">Monto (Bs)</ion-label>
            <ion-input type="number" [(ngModel)]="pagoNuevo.monto"></ion-input>
          </ion-item>

          <!-- M√©todo -->
          <ion-item>
            <ion-label>M√©todo</ion-label>
            <ion-select [(ngModel)]="pagoNuevo.metodo_pago">
              <ion-select-option value="Efectivo">Efectivo</ion-select-option>
              <ion-select-option value="Transferencia">Transferencia</ion-select-option>
              <ion-select-option value="Tarjeta">Tarjeta</ion-select-option>
            </ion-select>
          </ion-item>

          <!-- Fecha autom√°tica -->
          <ion-item>
            <ion-label>
              <strong>Fecha Pago:</strong><br>
              {{ pagoNuevo.fecha_pago | date:'medium':'':'es-BO' }}
            </ion-label>
          </ion-item>

        </ion-list>

        <ion-button expand="block" shape="round"
                    color="success"
                    (click)="guardarNuevoPago()">
          <ion-icon slot="start" name="checkmark-circle-outline"></ion-icon>
          Confirmar Renovaci√≥n
        </ion-button>

      </ion-content>

    </ng-template>
  </ion-modal>





  <!-- ========================================================= -->
  <!-- üüß MODAL LISTA PROFESIONAL DE PAGOS -->
  <!-- ========================================================= -->
  <ion-modal [isOpen]="modalLista" (willDismiss)="modalLista = false">
    <ng-template>

      <ion-header>
        <ion-toolbar color="medium">
          <ion-title>Pagos Registrados</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="modalLista = false">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">

        <!-- Buscador -->
        <ion-searchbar
          placeholder="Buscar atleta o entrenamiento..."
          [(ngModel)]="buscar"
          (ionInput)="aplicarFiltros()">
        </ion-searchbar>

        <!-- Filtros -->
        <ion-grid>
          <ion-row>

            <ion-col size="6">
              <ion-item>
                <ion-label>M√©todo</ion-label>
                <ion-select [(ngModel)]="filtroMetodo" (ionChange)="aplicarFiltros()">
                  <ion-select-option value="">Todos</ion-select-option>
                  <ion-select-option value="Efectivo">Efectivo</ion-select-option>
                  <ion-select-option value="Transferencia">Transferencia</ion-select-option>
                  <ion-select-option value="Tarjeta">Tarjeta</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

            <ion-col size="6">
              <ion-item>
                <ion-label>Ordenar</ion-label>
                <ion-select [(ngModel)]="ordenarPor" (ionChange)="aplicarFiltros()">
                  <ion-select-option value="">Ninguno</ion-select-option>
                  <ion-select-option value="fecha">Fecha</ion-select-option>
                  <ion-select-option value="monto">Monto</ion-select-option>
                </ion-select>
              </ion-item>
            </ion-col>

          </ion-row>
        </ion-grid>


        <!-- Lista profesional -->
        <ion-list>
          <ion-item *ngFor="let p of pagosFiltrados" lines="full">

            <ion-grid>
              <ion-row class="ion-align-items-center">

                <ion-col size="9">

                  <h3><strong>{{ p.atleta }}</strong></h3>
                  <p><strong>Entrenamiento:</strong> {{ p.entrenamiento }}</p>

                  <p><strong>Monto:</strong> Bs {{ p.monto }}</p>
                  <p><strong>Fecha Pago:</strong> {{ p.fecha_pago | date:'medium' }}</p>

                  <p><strong>M√©todo:</strong> {{ p.metodo_pago }}</p>

                  <p><strong>N¬∞ Pago:</strong> {{ p.numero_pago }}</p>

                  <p *ngIf="p.renovacion" style="color:#0a7900;">
                    <strong>Renovaci√≥n aplicada</strong>
                  </p>

                </ion-col>

                <ion-col size="3" class="ion-text-right">

                  <!-- Ver historial -->
                  <ion-button size="small" color="primary"
                              (click)="abrirHistorial(p.id_inscripcion)">
                    <ion-icon name="time-outline"></ion-icon>
                  </ion-button>

                  <!-- Eliminar -->
                  <ion-button size="small" color="danger"
                              (click)="abrirEliminarDesdeLista(p)">
                    <ion-icon name="trash-outline"></ion-icon>
                  </ion-button>

                </ion-col>

              </ion-row>
            </ion-grid>

          </ion-item>
        </ion-list>

      </ion-content>
    </ng-template>
  </ion-modal>





  <!-- ========================================================= -->
  <!-- üü™ MODAL HISTORIAL -->
  <!-- ========================================================= -->
  <ion-modal [isOpen]="modalHistorial" (willDismiss)="modalHistorial = false">
    <ng-template>

      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Historial de Pagos</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="modalHistorial = false">Cerrar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">

        <ion-list>
          <ion-item *ngFor="let h of historialPagos">

            <ion-label>
              <h2><strong>Pago #{{ h.numero_pago }}</strong></h2>

              <p><strong>Monto:</strong> Bs {{ h.monto }}</p>
              <p><strong>Fecha:</strong> {{ h.fecha_pago | date:'medium' }}</p>
              <p><strong>M√©todo:</strong> {{ h.metodo_pago }}</p>

              <p *ngIf="h.renovacion" style="color:#0a7900;">
                Renovaci√≥n aplicada ({{ h.fecha_fin_anterior | date:'shortDate' }} ‚Üí 
                {{ h.fecha_fin_nueva | date:'shortDate' }})
              </p>

            </ion-label>

          </ion-item>
        </ion-list>

      </ion-content>

    </ng-template>
  </ion-modal>



  <!-- ========================================================= -->
  <!-- üî¥ MODAL ELIMINAR -->
  <!-- ========================================================= -->
  <ion-modal [isOpen]="modalEliminar" (willDismiss)="modalEliminar = false">
    <ng-template>

      <ion-header>
        <ion-toolbar color="danger">
          <ion-title>Eliminar Pago</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="modalEliminar = false">Cancelar</ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content class="ion-padding">

        <p class="ion-text-center">
          ¬øSeguro que deseas eliminar este pago?
        </p>

        <ion-item>
          <ion-label><strong>Atleta:</strong></ion-label>
          <ion-text>{{ pagoEliminar?.atleta }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label><strong>Monto:</strong></ion-label>
          <ion-text>Bs {{ pagoEliminar?.monto }}</ion-text>
        </ion-item>

        <ion-item>
          <ion-label><strong>Fecha:</strong></ion-label>
          <ion-text>{{ pagoEliminar?.fecha_pago | date:'medium' }}</ion-text>
        </ion-item>

        <ion-button expand="block" shape="round"
                    color="danger"
                    (click)="confirmarEliminar()">
          <ion-icon slot="start" name="trash-outline"></ion-icon>
          Eliminar
        </ion-button>

      </ion-content>

    </ng-template>
  </ion-modal>

</ion-content>
